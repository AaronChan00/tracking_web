<!DOCTYPE html>
<html>
    <head>
      <title>Tracking Api</title>
      <script src="https://code.jquery.com/git/jquery-3.x-git.min.js"></script>
      <!-- <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.6.0.js"></script>-->
      
    </head>

    <body>
      <h1>Bearer Token Authentication</h1>
      
      <p><button id="btnFetch">Click to send a Request</button></p>
      
      <div class="container" style="width:900px;height: 500px;border: 1px solid #999; background: #efefef;">
      <p id="trackNo">

      </p>
      <p id="data">

      </p>
      </div>
      
      <script>
        var print_trackNo = document.getElementById("trackNo");
        var print_data = document.getElementById("data");

      jQuery(function(){
        var arr_trackingNos = ['GTS10201500034HK'];
        var _dataJSON = {"trackingNos": arr_trackingNos};
        
        jQuery("#btnFetch").click(function(){
            console.log(_dataJSON);
            console.log(JSON.stringify(_dataJSON));
            
            jQuery.ajax({
                url: "http://oms.gtschain.com/api/openapi/shipmenttrace/traceShipment",
                headers: {
                    'ApiToken':'8SDSADFA923&*@SDASDA'
                },
                method: 'POST',
                dataType: 'json',
                contentType: "application/json",
                data: JSON.stringify(_dataJSON),
                success: function(data){
                    console.log(data);
                    var date = new Date(data.data[0].traces[0].event_time)
                /*
                    print_data.innerHTML = "Date: "+date.getDate()+
                                            "/"+date.getMonth()+
                                            "/"+date.getFullYear()+
                                            " "+date.getHours()+
                                            ":"+date.getMinutes();
                                            var col = [];
                */
                    var col = []
                    for (var i = 0; i < data.data[0].traces.length; i++) {
                        for (var key in data.data[0].traces[i]) {
                            if (col.indexOf(key) === -1) {
                                col.push(key);
                            }
                        }
                    }

                     // CREATE DYNAMIC TABLE.
                    var table = document.createElement("table")
                    var tr = table.insertRow(-1)

                    // TABLE HEADER.
                    for (var i = 0; i < col.length; i++) {
                        var th = document.createElement("th");      
                        th.innerHTML = col[i];
                        tr.appendChild(th);
                    }
                    // ADD JSON DATA TO THE TABLE AS ROWS.
                    for (var i = 0; i < data.data[0].traces.length; i++) {
                        tr = table.insertRow(-1);
                        for (var j = 0; j < col.length; j++) {
                            var tabCell = tr.insertCell(-1);
                            tabCell.innerHTML = data.data[0].traces[i][col[j]];
                        }
                    }         
                    print_data.innerHTML = "";
                    print_data.appendChild(table);              
                    },
                error: function(errMsg) {
                    console.log(errMsg);
                    }
              
              });
             
              print_trackNo.innerHTML = JSON.stringify(_dataJSON);
              
        });
        
        });
        
        
      </script>
    </body>
</html>
